{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "newVMName": {
      "type": "string",
      "metadata": {
        "description": "The name of the new vm to be created."
      }
    }
    
   
   
  },
  "variables": {
    "labSubnetName": "Subnet3",
    "labVirtualNetworkId": "[resourceId('Microsoft.DevTestLab/labs/virtualnetworks', variables('existingLabName'), variables('labVirtualNetworkName'))]",
    "labVirtualNetworkName": "mitchell__azure",
    "resourceName": "[concat(variables('existingLabName'), '/', parameters('newVMName'))]",
    "resourceType": "Microsoft.DevTestLab/labs/virtualMachines",
    "sqlImagePublisher": "MicrosoftSQLServer",
    "sqlImageOffer": "SQL2014-WS2012R2",
    "sqlImageSku": "Standard",
    "existingCustomImageId": "/subscriptions/352b4bd5-2f5d-4e82-ab23-37e96afc58b1/resourcegroups/acsrg527780/providers/microsoft.devtestlab/labs/acs/customimages/garycustomtemplate1",
    "newVMSize": "Standard_DS1_v2",
    "userName": "SomeAdmin",
    "password": "SomePassword!",
    "existingLabName": "ACS"

  },
  "resources": [
    {
      "name": "[variables('resourceName')]",
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Compute/labs/virtualMachines",
      "location": "[resourceGroup().location]",
      "properties": {
        "customImageId": "[variables('existingCustomImageId')]",
        "size": "[variables('newVMSize')]",
        "userName": "[variables('userName')]",

        "password": "[variables('password')]",
        "labVirtualNetworkId": "[variables('labVirtualNetworkId')]",
        "labSubnetName": "[variables('labSubnetName')]",
        "disallowPublicIpAddress": true
      }
    }
 

  ],
  "outputs": {
    "vmId": {
      "type": "string",
      "value": "[resourceId(variables('resourceType'), variables('existingLabName'), parameters('newVMName'))]"
    }
  }
}